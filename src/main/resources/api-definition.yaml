#%RAML 0.8
---
title: OpenLMIS Stock Management
version: "@version@"
baseUri: "@baseUrl@"

documentation:
    - title: Getting Started
      content: Welcome to the OpenLMIS Stock Management Service documentation.

resourceTypes:
    - collection:
        get:
            responses:
                200:
                  description: Collection retrieved successfully
                  headers:
                    X-Content-Type-Options:
                    X-XSS-Protection:
                  body:
                      application/json:
                          schema: <<schema>>
                404:
                  description: Collection is empty.
                  headers:
                    X-Content-Type-Options:
                    X-XSS-Protection:
        post:
            body:
                application/json:
                    schema: <<schema>>
            responses:
                201:
                  description: Item created successfully
                  headers:
                    X-Content-Type-Options:
                    X-XSS-Protection:
                  body:
                      application/json:
                          schema: <<schema>>
    - member:
        get:
            responses:
                200:
                    body:
                        application/json:
                            schema: <<schema>>
        post:
            body:
                application/json:
                    schema: <<schema>>
            responses:
                200:
                    body:
                        application/json:
                            schema: <<schema>>
        delete:
            responses:
                200:

traits:
    - secured:
          queryParameters:
              access_token:
                  displayName: access_token
                  description: OAuth2 access token
                  type: string
                  required: true
                  repeat: false

/api:

  /stockCardTemplates:
      get:
        is: [ secured ]
        description: Get stock card template
        queryParameters:
          facilityType:
            required: false
          program:
            required: false
        responses:
          200:
            description: |
              Returns a default templte with all fields set to not display when no query parameters are passed.

              Returns template that matches facility type and program when query parameters are given.
            headers:
              X-Content-Type-Options:
              X-XSS-Protection:
            body:
              application/json:
          404:
            description: Stock card template not found for the given query parameter.

      post:
        is: [ secured ]
        description: Create stock card template for a facility-type&program combination.
        body:
          application/json:
            example: |
              {
                facilityType: "id",
                program: "id",
                stockCardOptionalFields:{
                  packSize: false,
                  packSizeDisplayOrder: 1,
                  //... other optional fields
                },
                stockCardLineItemOptionalFields:{
                  //... similar structure to the above
                }
              }
        responses:
          200:
            description: Indicates that a new stock card template has been created
          400:
            description: Indicates that validation failed while trying to create template

  /stockEvent:
      post:
        is: [ secured ]
        description: Create a new stock event
        body:
          application/json:
            example:  |
              {
                "lineItems":[
                  {facility:"f1", "product":"pid1",reason:"rid1","quantity":"10" ......},
                  {facility:"f2", "product":"pid2",reason:"rid2","quantity":"15" ......}
                  //product instead of stock card is used in the second property
                  //because a stock card may not exist yet
                ]
              }

        responses:
          200:
            description: Stock event has been processed, all corresponding line items have been created.
          207:
            description: Not all line items were created.
            body:
              application/json:
                example: |
                  {
                    createdLineItems:[
                      {id:"line item id1", ......}
                      //......
                    ],
                    failedLineItems:[
                      {lineItem:{...}, failureReason:"..."}
                      //......
                    ]
                  }

  /stockCards:
      get:
        is: [ secured ]
        description: Get a list of stock cards of a facility, with full details of each stock card.
        queryParameters:
          facility:
            required: true
            description: Facility id, indicates the facility that the queried stock cards should belong to.
          program:
            required: false
            description: When provided, returns stock cards under this program.
        responses:
          200:
            body:
              application/json:

  /stockCardSummaries:
      get:
        is: [ secured ]
        description: Get summaries of stock cards, which contains SOH, product name, and other essential information. This will NOT return any line items. (This could be used by front end for list view.)
        queryParameters:
          facility:
            required: true
            description: Facility id, indicates the facility that the queried stock card summaries should belong to.
          program:
            required: false
            description: When provided, returns stock cards under this program.
        responses:
          200:
            body:
              application/json:

  /stockCards/{id}:
      get:
        is: [ secured ]
        description: Get full details of one stock card.
        responses:
          200:
            body:
              application/json: